"use strict"; var __extends = function () { var e = Object.setPrototypeOf || { __proto__: [] } instanceof Array && function (e, a) { e.__proto__ = a } || function (e, a) { for (var t in a) a.hasOwnProperty(t) && (e[t] = a[t]) }; return function (a, t) { function i() { this.constructor = a } e(a, t), a.prototype = null === t ? Object.create(t) : (i.prototype = t.prototype, new i) } }(); !function () { function e(a, t, i) { function n(r, s) { if (!t[r]) { if (!a[r]) { var d = "function" == typeof require && require; if (!s && d) return d(r, !0); if (o) return o(r, !0); var l = new Error("Cannot find module '" + r + "'"); throw l.code = "MODULE_NOT_FOUND", l } var h = t[r] = { exports: {} }; a[r][0].call(h.exports, function (e) { return n(a[r][1][e] || e) }, h, h.exports, e, a, t, i) } return t[r].exports } for (var o = "function" == typeof require && require, r = 0; r < i.length; r++)n(i[r]); return n } return e }()({ 1: [function (e, a, t) { Object.defineProperty(t, "__esModule", { value: !0 }); var i = function () { function e() { } return e.init = function () { Laya.ClassUtils.regClass }, e.width = 640, e.height = 1136, e.scaleMode = "fixedwidth", e.screenMode = "none", e.alignV = "top", e.alignH = "left", e.startScene = "", e.sceneRoot = "", e.debug = !1, e.stat = !1, e.physicsDebug = !1, e.exportSceneToJson = !0, e }(); t.default = i, i.init() }, {}], 2: [function (e, a, t) { Object.defineProperty(t, "__esModule", { value: !0 }); var i = e("./GameConfig"), n = function () { function e() { Laya.isWXOpenDataContext = !0, Laya.isWXPosMsg = !0, window.Laya3D ? Laya3D.init(i.default.width, i.default.height) : Laya.init(i.default.width, i.default.height, Laya.WebGL), Laya.Physics && Laya.Physics.enable(), Laya.DebugPanel && Laya.DebugPanel.enable(), Laya.stage.scaleMode = i.default.scaleMode, Laya.stage.screenMode = i.default.screenMode, Laya.URL.exportSceneToJson = i.default.exportSceneToJson, (i.default.debug || "true" == Laya.Utils.getQueryString("debug")) && Laya.enableDebugPanel(), i.default.physicsDebug && Laya.PhysicsDebugDraw && Laya.PhysicsDebugDraw.enable(), i.default.stat && Laya.Stat.show(), Laya.alertGlobalError = !0, this.onConfigLoaded() } return e.prototype.onVersionLoaded = function () { Laya.AtlasInfoManager.enable("fileconfig.json", Laya.Handler.create(this, this.onConfigLoaded)) }, e.prototype.onConfigLoaded = function () { var e = this; if (Laya.Browser.onMiniGame) { var a = Laya.Browser.window.wx; a.onMessage(function (t) { if ("ranking" == t.action) { var i = t.gameData[0]; Laya.Browser.window.scX = i; var n = t.gameData[1]; a.getFriendCloudStorage({ keyList: ["score"], success: function (a) {null != Laya.stage.getChildByName("layaList") && Laya.stage.removeChildByName("layaList"); var t = e.sortData(a.data), i = new Laya.Sprite; i.name = "layaList"; var r = e.getUserIndex(t, n), s = new Laya.List, d = Laya.Browser.window.scX; Laya.Browser.window.scY; s.itemRender = o, s.repeatX = 1, s.repeatY = 6, s.x = 0, s.y = 0, s.vScrollBarSkin = "", s.selectEnable = !0; for (var l = [], h = 0; h < t.length; ++h) { var g = new Laya.Sprite; g.width = 521 * d, g.height = 81 * d, g.pos(0, 15 * h), g.loadImage("openData/img/list.png"); var c; 0 == h ? (c = new Laya.Sprite, c.width = 52 * d, c.height = 58 * d, c.loadImage("openData/img/gold.png")) : 1 == h ? (c = new Laya.Sprite, c.width = 58 * d, c.height = 64 * d, c.loadImage("openData/img/yin.png")) : (c = new Laya.Text, c.text = "" + (h + 1), c.color = "#fcd26f", c.fontSize = 26 * d), c.pos((75 * d - c.width) / 2, (g.height - c.height) / 2), g.addChild(c); var p = new Laya.Sprite, f = new Laya.Sprite; f.width = 64 * d, f.height = 65 * d, f.loadImage("openData/img/cir.png"); var u = new Laya.Sprite; u.width = 65 * d, u.height = 65 * d, u.loadImage(t[h].avatarUrl), p.pos(70 * d, (g.height - f.height) / 2), p.addChild(f), p.addChild(u), p.mask = f, g.addChild(p); var y = new Laya.Text, L = t[h].nickname.toString().length > 6 ? t[h].nickname.substring(0, 6) + "..." : t[h].nickname; y.text = "" + L, y.color = "#fff", y.fontSize = 26 * d, y.pos(p.x + f.width + 10 * d, (g.height - y.height) / 2), g.addChild(y); var w = new Laya.Text; w.text = t[h].KVDataList[0].value + "关", w.align = "right", w.color = "#fff", w.fontSize = 28 * d, w.pos(g.width - w.width - 15 * d, (g.height - w.height) / 2), g.addChild(w); var v = e.getImage("openData/img/line.png", 480 * d, 3 * d, (g.width - 480 * d) / 2, g.height + 1.5 * d); g.addChild(v), l.push(g) } s.array = l, i.pos(0, 0); var m = new Laya.Sprite; m.width = 521 * d, m.height = 81 * d, m.pos(0, 630 * d), m.loadImage("openData/img/list1.png"); var c; -1 == r ? (c = new Laya.Text, c.text = "∞", c.color = "#fcd26f", c.fontSize = 26 * d) : 0 == r ? (c = new Laya.Sprite, c.width = 52 * d, c.height = 58 * d, c.loadImage("openData/img/gold.png")) : 1 == r ? (c = new Laya.Sprite, c.width = 58 * d, c.height = 64 * d, c.loadImage("openData/img/yin.png")) : (c = new Laya.Text, c.text = "" + (r + 1), c.color = "#fcd26f", c.fontSize = 26 * d), c.pos((75 * d - c.width) / 2, (m.height - c.height) / 2), m.addChild(c); var S = new Laya.Sprite, D = new Laya.Sprite; D.width = 64 * d, D.height = 65 * d, D.loadImage("openData/img/cir.png"); var C = new Laya.Sprite; C.width = 65 * d, C.height = 65 * d, -1 == r ? C.loadImage("openData/img/d.png") : C.loadImage("" + t[r].avatarUrl), S.pos(70 * d, (m.height - D.height) / 2), S.addChild(D), S.addChild(C), S.mask = D, m.addChild(S); var x = new Laya.Text, I = ""; I = -1 == r ? "无名氏" : t[r].nickname.toString().length > 6 ? t[r].nickname.substring(0, 6) + "..." : t[r].nickname, x.text = "" + I, x.color = "#fff", x.fontSize = 26 * d, x.pos(S.x + D.width + 10 * d, (m.height - x.height) / 2), m.addChild(x); var b = new Laya.Text; b.text = -1 == r ? "暂无数据" : t[r].KVDataList[0].value + "关", b.align = "right", b.color = "#fff", b.fontSize = 28 * d, b.pos(m.width - b.width - 15 * d, (m.height - b.height) / 2), m.addChild(b), i.addChild(s), i.addChild(m), Laya.stage.addChild(i) } }) } else if ("set" == t.action) a.getUserCloudStorage({ keyList: ["score"], success: function (e) { (void 0 == e.KVDataList[0] || parseFloat(e.KVDataList[0].value) <= t.score) && (console.log("记录数据"), a.setUserCloudStorage({ KVDataList: [{ key: "score", value: t.score.toString() }], success: function () { console.log("-------存储-----：") } })) } }); else if ("overstep" == t.action) { var r = t.score; a.getFriendCloudStorage({ keyList: ["score"], success: function (a) { null != Laya.stage.getChildByName("overstep") && Laya.stage.removeChildByName("overstep"); var i = e.sortDataUp(a.data), n = e.userScoreIndex(i, r), o = new Laya.Sprite; o.name = "overstep"; var s = t.scX; if (-1 != n) { var d = new Laya.Sprite, l = new Laya.Sprite; l.width = 50 * s, l.height = 50 * s, l.loadImage("openData/img/imgOpacity.png"); var h = new Laya.Sprite; h.width = 50 * s, h.height = 50 * s, h.loadImage(i[n].avatarUrl), d.pos(10 * s, 30 * s), d.addChild(l), d.addChild(h), d.mask = l; var g = i[n].nickname.toString().length > 5 ? i[n].nickname.substring(0, 5) + "..." : i[n].nickname, c = new Laya.Text; c.fontSize = 22 * s, c.color = "#fff", c.align = "center", c.width = 70 * s, c.text = g, c.pos(60 * s, (80 - c.height) * s / 2); var p = new Laya.Text; p.fontSize = 28 * s, p.color = "#fff", p.text = i[n].KVDataList[0].value + "关", p.align = "center", p.width = 70 * s, p.pos(60 * s, c.y + 1.2 * c.height), o.addChild(c), o.addChild(d), o.addChild(p), o.pos(0, 0) } else { var f = new Laya.Text; f.fontSize = 24 * s, f.color = "#f00", f.text = "你很棒棒哟，你是第一名!", f.width = 180 * s, f.align = "center", f.wordWrap = !0, f.pos((199 * s - f.width) / 2, (116 * s - f.height / 1.5) / 2), o.addChild(f), o.pos(0, 0) } Laya.stage.addChild(o) } }) } else "clear" == t.action && (null != Laya.stage.getChildByName("overstep") && Laya.stage.removeChildByName("overstep"), null != Laya.stage.getChildByName("layaList") && Laya.stage.removeChildByName("layaList")) }) } }, e.prototype.getImage = function (e, a, t, i, n) { void 0 === i && (i = 0), void 0 === n && (n = 0); var o = new Laya.Sprite; return o.width = a, o.height = t, o.loadImage("" + e), o.pos(i, n), o }, e.prototype.userScoreIndex = function (e, a) { for (var t = 0; t < e.length; ++t)if (parseInt(e[t].KVDataList[0].value) > a) return t; return -1 }, e.prototype.getUserIndex = function (e, a) { for (var t = 0; t < e.length; t++)if (e[t].openid == a) return t; return -1 }, e.prototype.sortData = function (e) { for (var a = 0; a < e.length; a++)for (var t = 0; t < e.length; t++) { var i; parseInt(e[a].KVDataList[0].value) > parseInt(e[t].KVDataList[0].value) && (i = e[a], e[a] = e[t], e[t] = i) } return e }, e.prototype.sortData1 = function (e) { for (var a = 0; a < e.length; a++)for (var t = 0; t < e.length; t++) { var i; parseInt(e[a].KVDataList[1].value) > parseInt(e[t].KVDataList[1].value) && (i = e[a], e[a] = e[t], e[t] = i) } return e }, e.prototype.sortDataUp = function (e) { for (var a = 0; a < e.length; a++)for (var t = 0; t < e.length; t++) { var i; parseInt(e[a].KVDataList[0].value) < parseInt(e[t].KVDataList[0].value) && (i = e[a], e[a] = e[t], e[t] = i) } return e }, e }(), o = function (e) { function a() { var a = e.call(this) || this; return a.size(521 * Laya.Browser.window.scX, 90 * Laya.Browser.window.scX), a } return __extends(a, e), a }(Laya.Box); new n }, { "./GameConfig": 1 }] }, {}, [2]);